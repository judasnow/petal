!function(){$.ui.isAjaxApp=!1,$.ui.openLinksNewTab=!1,$.ui.resetScrollers=!1,$.ui.nativeTouchScroll=!1,$.ui.autoLaunch=!1,$.ui.showBackbutton=!1,$.ui.customClickHandler=function(){return!0};var a=function(){var a=document.getElementsByTagName("HEAD").item(0),b=document.createElement("script");b.setAttribute("data-main","/build/script/rquirejs_main_build.js"),b.src="/build/script/lib/require.js",a.appendChild(b),$.ui.showMask()},b=function(){window.localStorage.setItem("petal:object_user_info",""),window.localStorage.setItem("petal:is_new_login","true"),window.localStorage.setItem("petal:root_msg_id","0"),window.localStorage.setItem("petal:send_msg_target_user_id","")};window.updateSysNotice=function(a){window.$sysNotice=window.$sysNotice||$("#system_notice_box"),window.$sysNotice.text(a).attr("style","margin-left: -"+window.$sysNotice.width()/2+"px;z-index: 9999"),setTimeout(function(){window.$sysNotice.attr("style","z-index: -9999")},2e3)},$.ui.addOrUpdateDiv=function(a,b,c){0===$("#"+a).length?$.ui.addContentDiv(a,b,!0,!0):$.ui.updateContentDiv(a,b);var d=$("#"+a);return("undefined"==typeof c||c===!1)&&d.attr("data-footer","none"),d.unbind()},$.ui.goBackWithDefault=function(){1===$.ui.history.length?window.router.navigate("/#stream",{trigger:!0}):$.ui.goBack()},$.ui.ready(function(){console.log("ui ready"),a()});var c=function(a,c,d){$.post("/api/do_login",{username:a,password:c},function(a){try{var c=JSON.parse(a);if("ok"===c.result){var e=JSON.stringify(c.user_info);if("undefined"==typeof e)throw new Error("json stringify user_info error");b(),window.location.hash="",window.localStorage.setItem("petal:object_user_info",e),window.localStorage.setItem("petal:is_new_login","true"),$.ui.launch()}else logging=!1,d()}catch(f){console.log("登录时发生异常"),console.dir(f.stack),logging=!1,d()}})},d=function(){var a=window.location.hash.replace(/^\#/,"").replace(/^\!/,"");c(a,"huaban123",function(){window.location.hash="",$("#login").show()})},e=function(){console.log("appMobi.device.ready fire"),AppMobi.device.setRotateOrientation("portrait"),AppMobi.device.setAutoRotate(!1),webRoot=AppMobi.webRoot+"/",AppMobi.device.hideSplashScreen(),$.ui.blockPageScroll()},f=function(){$("#splashscreen").hide();var a=window.localStorage.getItem("petal:object_user_info");if(null===a||""===a)if(""!==window.location.hash)d();else{var b=$("#login").show(),e=b.find(".username"),f=b.find(".password");b.find(".do_login").click(function(){c(e.val(),f.val(),function(){window.updateSysNotice("用户名或密码错误")})})}else 1===window.location.hash.indexOf("!")&&(window.location.hash=""),$.ui.launch()};document.addEventListener("appMobi.device.ready",e,!1),document.addEventListener("DOMContentLoaded",f,!1)}();