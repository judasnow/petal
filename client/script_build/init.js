/*! petal_client 2013-07-08 */
!function(){$.ui.isAjaxApp=!1,$.ui.openLinksNewTab=!1,$.ui.resetScrollers=!1,$.ui.autoLaunch=!1,$.ui.showBackbutton=!1,$.ui.customClickHandler=function(){return!0},$.ui.ready(function(){var a=document.getElementsByTagName("HEAD").item(0),b=document.createElement("script");b.setAttribute("data-main","/script/main.js"),b.src="/script/lib/require.js",a.appendChild(b)});var a=function(){AppMobi.device.setRotateOrientation("portrait"),AppMobi.device.setAutoRotate(!1),webRoot=AppMobi.webRoot+"/",AppMobi.device.hideSplashScreen()};document.addEventListener("appMobi.device.ready",a,!1),window.updateSysNotice=function(a){window.$sysNotice=window.$sysNotice||$("#system_notice_box"),window.$sysNotice.text(a).attr("style","margin-left: -"+window.$sysNotice.width()/2+"px;z-index: 9999"),setTimeout(function(){window.$sysNotice.attr("style","z-index: -9999")},2e3)};var b=function(){window.localStorage.setItem("petal:object_user_info",""),window.localStorage.setItem("petal:is_new_login","true"),window.localStorage.setItem("petal:root_msg_id","0"),window.localStorage.setItem("petal:send_msg_target_user_id","")},c=function(a,c,d){$.post("/api/do_login",{username:a,password:c},function(a){try{var c=JSON.parse(a);if("ok"===c.result){var e=JSON.stringify(c.user_info);if("undefined"==typeof e)throw new Error("json stringify user_info error");b(),window.location.hash="",window.localStorage.setItem("petal:object_user_info",e),window.localStorage.setItem("petal:is_new_login","true"),$.ui.launch()}else logging=!1,d()}catch(f){console.log("登录时发生异常"),console.dir(f.stack),logging=!1,d()}})},d=function(){$.get("/api/get_username_by_wx_id?wx_id="+window.location.hash.replace(/^\#/,""),function(a){var b=JSON.parse(a);"ok"===b[0]&&c(b[1].username,"huaban123",function(){window.location.hash="",window.location.reload()})})},e=function(){$("#splashscreen").hide();var a=window.localStorage.getItem("petal:object_user_info");if(null===a||""===a)if(""!==window.location.hash)d();else{var b=$("#login").show(),e=b.find(".username"),f=b.find(".password");b.find(".do_login").click(function(){c(e.val(),f.val(),function(){window.updateSysNotice("用户名或密码错误")})})}else $.ui.launch()};document.addEventListener("DOMContentLoaded",e,!1),$.ui.addOrUpdateDiv=function(a,b,c){0===$("#"+a).length?$.ui.addContentDiv(a,b,!0,!0):$.ui.updateContentDiv(a,b);var d=$("#"+a);return("undefined"==typeof c||c===!1)&&d.attr("data-footer","none"),d.unbind()},$.ui.goBackWithDefault=function(){1===$.ui.history.length?window.router.navigate("/#stream",{trigger:!0}):$.ui.goBack()}}();